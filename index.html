<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Password Strength Checker</title>

  <!-- Material Icons (for eye + check/close + copy) -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <style>
    /* ====== Dark theme colors (kept same layout/structure as before) ====== */
    :root{
      --bg: #0f1220;            /* page background */
      --panel: #171b2e;         /* card background */
      --panel-2: #1e2540;       /* inner elements */
      --text: #e8ecff;          /* primary text */
      --muted: #a9b1d6;         /* secondary text */
      --border: #2b355a;        /* subtle borders */
      --focus: #5aa9ff;         /* focus / accent */
      --btn: #2b7cff;           /* primary button */
      --btn-hover: #1f65d6;     /* button hover */
      --valid: #31d090;         /* green */
      --invalid: #ff5c5c;       /* red */
      --bar-weak: #ff5c5c;
      --bar-mid: #f0c24b;
      --bar-strong: #38d39f;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    /* Container keeps same proportions/radius as your previous design */
    .container {
      width: 420px;
      background: var(--panel);
      border-radius: 8px;
      box-shadow: 0 6px 22px rgba(0,0,0,0.35);
      padding: 28px 28px;
    }

    h2 {
      margin: 0 0 18px 0;
      text-align: center;
      font-size: 22px;
      color: var(--text);
      font-weight: 600;
    }

    /* Inputs: same shape/spacing; just dark colors */
    .input-group { position: relative; margin-bottom: 14px; width: 100%; }
    input[type="text"],
    input[type="number"],
    input[type="password"],
    input[type="email"]{
      width: 100%;
      padding: 12px;
      padding-right: 44px;              /* space for the eye/copy icons */
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--panel-2);
      color: var(--text);
      outline: none;
      font-size: 14px;
      transition: border-color .2s, box-shadow .2s;
    }
    input::placeholder{ color: var(--muted); }
    input:focus{
      border-color: var(--focus);
      box-shadow: 0 0 0 3px rgba(90,169,255,0.15);
    }

    /* Eye toggle (kept exactly like your earlier design, Material Icons) */
    .toggle-eye{
      position: absolute;
      top: 50%;
      right: 12px;
      transform: translateY(-50%);
      cursor: pointer;
      color: var(--muted);
      user-select: none;
    }

    /* Buttons: same shape/weight; dark theme colors */
    button {
      padding: 9px 14px;
      border: none;
      border-radius: 6px;
      background: var(--btn);
      color: white;
      font-weight: 500;
      cursor: pointer;
      transition: background .2s, transform .15s;
    }
    button:hover { background: var(--btn-hover); transform: translateY(-1px); }

    .hidden { display: none; }

    /* Strength bar (unchanged structure) */
    .strength {
      height: 8px;
      background: #202744;
      border-radius: 4px;
      overflow: hidden;
      margin: 12px 0;
    }
    .strength-bar {
      height: 100%;
      width: 0%;
      background: var(--bar-weak);
      transition: width .3s, background .3s;
    }

    /* Criteria list (same layout, just dark colors) */
    .criteria { font-size: 13px; margin-top: 8px; color: var(--muted); }
    .criteria span {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
    }
    .criteria .icon { font-size: 18px; }
    .valid { color: var(--valid); }
    .invalid { color: var(--invalid); }

    .entropy, .crack-time {
      font-size: 12px; color: var(--muted); margin-top: 8px;
    }

    /* Suggestion box integrated (only shows when weak) */
    .suggestion-box {
      margin-top: 16px;
      padding: 14px;
      background: #1a2140;
      border: 1px dashed var(--border);
      border-radius: 8px;
    }
    .suggestion-box h3{
      margin: 0 0 10px 0; font-size: 15px; color: var(--text); font-weight: 600;
    }
    .suggestions{
      display: grid;
      gap: 8px;
    }
    .suggestion-row{
      position: relative;
    }
    .suggestion-input{
      width: 100%;
      background: var(--panel-2);
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 6px;
      padding: 12px 44px 12px 12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 13px;
    }
    .copy-btn{
      position: absolute;
      top: 50%;
      right: 8px;
      transform: translateY(-50%);
      background: transparent;
      border: none;
      padding: 6px;
      border-radius: 6px;
      color: var(--muted);
    }
    .copy-btn:hover{ background: rgba(255,255,255,0.06); color: var(--text); }

    .actions{
      margin-top: 10px;
      display: flex;
      gap: 8px;
      justify-content: flex-end;
    }
  </style>
</head>
<body>

  <!-- STEP 1: user info (name + birth year). After confirm, show checker -->
  <div class="container" id="infoBox">
    <h2>Enter Your Info</h2>
    <div class="input-group">
      <input type="text" id="username" placeholder="Your full name"/>
    </div>
    <div class="input-group">
      <input type="number" id="birthyear" placeholder="Your birth year (e.g., 1998)"/>
    </div>
    <button id="continueBtn">Continue</button>
  </div>

  <!-- STEP 2: password checker (same layout as before, dark colors) -->
  <div class="container hidden" id="passwordBox">
    <h2>Password Checker</h2>

    <div class="input-group">
      <input type="password" id="password" placeholder="Enter your password"/>
      <span class="toggle-eye material-icons" id="eye">visibility</span>
    </div>

    <div class="strength">
      <div class="strength-bar" id="strength-bar"></div>
    </div>

    <div class="criteria">
      <span id="length" class="invalid">
        <span class="material-icons icon">close</span> At least 8 characters
      </span>
      <span id="uppercase" class="invalid">
        <span class="material-icons icon">close</span> Uppercase letter
      </span>
      <span id="lowercase" class="invalid">
        <span class="material-icons icon">close</span> Lowercase letter
      </span>
      <span id="number" class="invalid">
        <span class="material-icons icon">close</span> Number
      </span>
      <span id="special" class="invalid">
        <span class="material-icons icon">close</span> Special character
      </span>
      <span id="personal" class="invalid">
        <span class="material-icons icon">close</span> No personal info
      </span>
    </div>

    <div class="entropy" id="entropy">Entropy: 0 bits</div>
    <div class="crack-time" id="crack-time">Crack time: Instant</div>

    <!-- Suggestion box appears ONLY when password is weak -->
    <div class="suggestion-box hidden" id="suggestBox">
      <h3>Suggested Strong Passwords</h3>
      <div class="suggestions" id="suggestions"></div>
      <div class="actions">
        <button id="regenBtn">Generate New</button>
      </div>
    </div>
  </div>

  <script>
    // ======= STEP 1 logic (collect user info) =======
    const infoBox = document.getElementById('infoBox');
    const passwordBox = document.getElementById('passwordBox');
    const continueBtn = document.getElementById('continueBtn');

    let userNameTokens = []; // split tokens of user's name
    let birthYear = 0;
    const currentYear = new Date().getFullYear();

    continueBtn.addEventListener('click', () => {
      const nameRaw = (document.getElementById('username').value || '').trim();
      const yearRaw = (document.getElementById('birthyear').value || '').trim();

      const y = Number(yearRaw);
      if (!nameRaw || !/^\d{4}$/.test(yearRaw) || y < 1920 || y > currentYear) {
        alert('Please enter a valid name and a birth year between 1920 and ' + currentYear + '.');
        return;
      }

      birthYear = y;
      // Split name into alphanumeric tokens (3+ chars) for checking
      userNameTokens = nameRaw
        .toLowerCase()
        .split(/[^a-z0-9]+/i)
        .filter(t => t.length >= 3);

      infoBox.classList.add('hidden');
      passwordBox.classList.remove('hidden');
      document.getElementById('password').focus();
    });

    // ======= STEP 2 logic (password checker) =======
    const pwdInput   = document.getElementById('password');
    const eye        = document.getElementById('eye');
    const bar        = document.getElementById('strength-bar');
    const entropyEl  = document.getElementById('entropy');
    const crackEl    = document.getElementById('crack-time');
    const suggestBox = document.getElementById('suggestBox');
    const suggestionsWrap = document.getElementById('suggestions');
    const regenBtn   = document.getElementById('regenBtn');

    // Eye toggle (kept from your previous design)
    eye.addEventListener('click', () => {
      if (pwdInput.type === 'password') {
        pwdInput.type = 'text';
        eye.textContent = 'visibility_off';
      } else {
        pwdInput.type = 'password';
        eye.textContent = 'visibility';
      }
    });

    pwdInput.addEventListener('input', updateStrength);
    regenBtn.addEventListener('click', () => renderSuggestions(3));

    function updateStrength() {
      const val = pwdInput.value;

      // Update criteria
      setCrit('length',    val.length >= 8);
      setCrit('uppercase', /[A-Z]/.test(val));
      setCrit('lowercase', /[a-z]/.test(val));
      setCrit('number',    /\d/.test(val));
      setCrit('special',   /[^A-Za-z0-9]/.test(val));

      // Personal info: name tokens or any 4-digit year in [1920..currentYear]
      const personalBad = containsPersonalInfo(val, userNameTokens, birthYear, currentYear);
      setCrit('personal', !personalBad);

      // Score = number of valid criteria (6 total)
      const ids = ['length','uppercase','lowercase','number','special','personal'];
      const score = ids.reduce((acc,id)=> acc + (document.getElementById(id).classList.contains('valid') ? 1 : 0), 0);

      // Strength bar + labels
      const pct = (score / 6) * 100;
      bar.style.width = pct + '%';
      bar.style.background = score <= 2 ? getComputedStyle(document.documentElement).getPropertyValue('--bar-weak')
                        : score <= 4 ? getComputedStyle(document.documentElement).getPropertyValue('--bar-mid')
                                     : getComputedStyle(document.documentElement).getPropertyValue('--bar-strong');

      // Entropy (simple pool model)
      let pool = 0;
      if (/[a-z]/.test(val)) pool += 26;
      if (/[A-Z]/.test(val)) pool += 26;
      if (/\d/.test(val))    pool += 10;
      if (/[^A-Za-z0-9]/.test(val)) pool += 32;
      const entropy = val.length ? Math.log2(Math.pow(pool, val.length)) : 0;
      entropyEl.textContent = `Entropy: ${entropy.toFixed(2)} bits`;

      // Crack time (very rough)
      const guesses = Math.pow(2, entropy);
      let crack = 'Instant';
      if (guesses >= 1e6  && guesses < 1e12) crack = 'Minutes';
      else if (guesses >= 1e12 && guesses < 1e18) crack = 'Years';
      else if (guesses >= 1e18) crack = 'Centuries';
      crackEl.textContent = `Crack time: ${crack}`;

      // Suggestion box logic:
      // show suggestions if WEAK (score <= 2). (You asked to show it for weak passwords)
      if (score <= 2) {
        suggestBox.classList.remove('hidden');
        // Generate if empty or if personal info is detected on each input
        if (!suggestionsWrap.children.length || personalBad) renderSuggestions(3);
      } else {
        suggestBox.classList.add('hidden');
      }
    }

    function setCrit(id, ok){
      const el = document.getElementById(id);
      el.className = ok ? 'valid' : 'invalid';
      el.querySelector('.icon').textContent = ok ? 'check' : 'close';
    }

    // Personal info detection
    function containsPersonalInfo(pwd, tokens, byear, current) {
      const v = (pwd || '').toLowerCase();

      // name tokens
      for (const t of tokens) {
        if (t && v.includes(t)) return true;
      }

      // exact birth year
      if (String(byear) && v.includes(String(byear))) return true;

      // any 4-digit year within [1920..currentYear]
      const yrs = v.match(/\d{4}/g) || [];
      for (const yStr of yrs) {
        const y = Number(yStr);
        if (y >= 1920 && y <= current) return true;
      }

      return false;
    }

    // Suggestions (lives INSIDE the suggest box â€” no separate external button)
    function renderSuggestions(n){
      suggestionsWrap.innerHTML = '';
      for (let i = 0; i < n; i++){
        const s = generateStrongPassword(18);
        const row = document.createElement('div');
        row.className = 'suggestion-row';

        const inp = document.createElement('input');
        inp.type = 'text';
        inp.className = 'suggestion-input';
        inp.value = s;
        inp.readOnly = true;

        const copy = document.createElement('button');
        copy.className = 'copy-btn';
        copy.innerHTML = '<span class="material-icons">content_copy</span>';
        copy.addEventListener('click', () => {
          navigator.clipboard.writeText(inp.value);
          copy.innerHTML = '<span class="material-icons">check</span>';
          setTimeout(()=> copy.innerHTML = '<span class="material-icons">content_copy</span>', 1200);
        });

        row.appendChild(inp);
        row.appendChild(copy);
        suggestionsWrap.appendChild(row);
      }
    }

    function generateStrongPassword(len=18){
      const upper = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      const lower = 'abcdefghijklmnopqrstuvwxyz';
      const nums  = '0123456789';
      const syms  = '!@#$%^&*()_+[]{}<>?';
      const all   = upper + lower + nums + syms;

      // ensure at least one of each class
      let out = '';
      out += upper[Math.floor(Math.random()*upper.length)];
      out += lower[Math.floor(Math.random()*lower.length)];
      out += nums[Math.floor(Math.random()*nums.length)];
      out += syms[Math.floor(Math.random()*syms.length)];

      while (out.length < len) {
        out += all[Math.floor(Math.random()*all.length)];
      }

      // simple shuffle
      out = out.split('').sort(() => Math.random() - 0.5).join('');
      return out;
    }
  </script>
</body>
</html>
